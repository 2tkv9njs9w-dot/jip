<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∫Æ‡ªâ‡∫≤‡∫ô‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫õ‡∫Ω‡∫Å‡∫à‡∫¥‡∫ö‡ªÜ - POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans Lao', sans-serif; background-color: #f1f5f9; overflow-x: hidden; }
        .hidden { display: none; }
        .active-scale:active { transform: scale(0.95); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        @media (max-width: 768px) {
            .pos-container { flex-direction: column; height: 100vh; }
            .menu-section { width: 100% !important; flex: 1; overflow-y: auto; padding-bottom: 250px; }
            .cart-section { 
                width: 100% !important; height: auto; position: fixed; bottom: 0; left: 0; z-index: 50;
                background: white; border-radius: 2.5rem 2.5rem 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            }
            .cart-scroll { max-height: 180px; overflow-y: auto; }
        }
    </style>
</head>
<body>

    <div id="page-login" class="flex items-center justify-center min-h-screen bg-gradient-to-br from-orange-500 to-orange-700 p-6">
        <div class="bg-white p-10 rounded-[3.5rem] shadow-2xl w-full max-w-sm text-center border-b-8 border-orange-200">
            
            <div class="w-28 h-28 bg-orange-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl border-4 border-orange-100 overflow-hidden p-2">
                <img src="https://voluntary-gray-s9ohiwocpj.edgeone.app/IMG_0333.jpeg" alt="Logo" class="w-full h-full object-contain">
            </div>

            <h1 class="text-3xl font-black text-slate-800 italic uppercase">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫õ‡∫Ω‡∫Å‡∫à‡∫¥‡∫ö‡ªÜ</h1>
            <p class="text-orange-500 mb-8 font-bold text-[10px] uppercase tracking-[0.3em]">Premium Experience</p>
            
            <div class="space-y-4 text-left">
                <div class="relative">
                    <label class="text-[10px] font-black text-slate-400 ml-4 mb-1 block uppercase">Security Login</label>
                    <div class="relative">
                        <span class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-300"><i class="fas fa-lock text-sm"></i></span>
                        <input type="password" id="login-pass" placeholder="‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ú‡ªà‡∫≤‡∫ô" 
                            class="w-full pl-12 pr-6 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-center text-xl outline-none focus:border-orange-500 transition-all">
                    </div>
                </div>
                <button onclick="checkLogin()" class="w-full bg-[#1a1c2e] text-white py-4 rounded-2xl font-black shadow-xl active-scale text-lg">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö</button>
            </div>
        </div>
    </div>

    <div id="page-table" class="hidden min-h-screen p-4 md:p-10">
        <div class="max-w-6xl mx-auto">
            <header class="flex justify-between items-center mb-10 px-2">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-orange-600 rounded-2xl flex items-center justify-center shadow-lg overflow-hidden p-1">
                        <img src="https://voluntary-gray-s9ohiwocpj.edgeone.app/IMG_0333.jpeg" alt="Logo" class="w-full h-full object-contain">
                    </div>
                    <h1 class="text-2xl font-black text-slate-800 italic uppercase">‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡ªÇ‡∫ï‡∫∞‡∫™‡∫±‡ªà‡∫á</h1>
                </div>
                <div class="flex gap-3">
                    <button onclick="showPage('page-report')" class="w-14 h-14 bg-white rounded-2xl border shadow-sm text-emerald-600 flex items-center justify-center active-scale"><i class="fas fa-chart-pie text-xl"></i></button>
                    <button onclick="showPage('page-admin')" class="w-14 h-14 bg-slate-900 rounded-2xl text-white shadow-lg flex items-center justify-center active-scale"><i class="fas fa-gear text-xl"></i></button>
                </div>
            </header>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6" id="table-grid"></div>
        </div>
    </div>

    <div id="page-pos" class="hidden h-screen flex flex-col bg-slate-50">
        <header class="bg-white border-b p-4 flex justify-between items-center px-6 sticky top-0 z-50">
            <button onclick="showPage('page-table')" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500 active-scale"><i class="fas fa-chevron-left"></i></button>
            <h2 id="pos-table-name" class="font-black text-xl text-orange-600 italic"></h2>
            <button onclick="clearTable()" class="bg-red-50 text-red-500 px-4 py-2 rounded-xl font-black text-xs active-scale border border-red-100">‡∫•‡ªâ‡∫≤‡∫á‡ªÇ‡∫ï‡∫∞</button>
        </header>
        
        <nav class="bg-white border-b flex gap-2 p-4 overflow-x-auto no-scrollbar">
            <button onclick="filterMenu('‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î')" class="category-btn px-8 py-2.5 rounded-2xl font-black bg-orange-600 text-white shadow-lg shrink-0">‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</button>
            <button onclick="filterMenu('‡∫≠‡∫≤‡∫´‡∫≤‡∫ô')" class="category-btn px-8 py-2.5 rounded-2xl font-black text-slate-500 bg-slate-100 shrink-0">‡∫≠‡∫≤‡∫´‡∫≤‡∫ô</button>
            <button onclick="filterMenu('‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°')" class="category-btn px-8 py-2.5 rounded-2xl font-black text-slate-500 bg-slate-100 shrink-0">‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°</button>
        </nav>

        <main class="flex flex-1 overflow-hidden pos-container">
            <section id="menu-list" class="menu-section p-6 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 content-start"></section>
            
            <aside class="cart-section w-full md:w-[400px] bg-white border-l flex flex-col shadow-2xl">
                <div class="p-5 border-b flex justify-between items-center bg-slate-50/50">
                    <span class="font-black text-slate-800 text-xs uppercase">‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫ó‡∫µ‡ªà‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å</span>
                    <span class="bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-[10px] font-black" id="cart-count">0</span>
                </div>
                <div id="cart-items" class="cart-scroll flex-1 p-4 space-y-3"></div>
                <div class="p-6 bg-white border-t-2 border-slate-50 space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400 font-black text-xs uppercase">‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</span>
                        <div class="text-right">
                            <span id="total-price" class="text-4xl font-black text-slate-900 tracking-tighter">0</span>
                            <span class="text-orange-600 font-bold text-xs ml-1">KIP</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="holdOrder()" class="bg-slate-800 text-white py-4 rounded-2xl font-black active-scale shadow-lg">‡∫û‡∫±‡∫Å‡∫ö‡∫¥‡∫ô</button>
                        <button onclick="checkout()" class="bg-orange-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-orange-200 active-scale text-lg">‡ªÑ‡∫•‡ªà‡ªÄ‡∫á‡∫¥‡∫ô</button>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <div id="page-admin" class="hidden min-h-screen p-6 bg-slate-100 flex flex-col items-center">
        <div class="max-w-md w-full bg-white p-8 rounded-[3.5rem] shadow-2xl border-b-8 border-slate-200">
            <h2 class="text-xl font-black mb-6 text-slate-800 border-b pb-4 text-center italic">‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡ªÄ‡∫°‡∫ô‡∫π‡ªÉ‡ªù‡ªà</h2>
            <div class="space-y-4">
                <input type="text" id="admin-name" placeholder="‡∫ä‡∫∑‡ªà‡ªÄ‡∫°‡∫ô‡∫π" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-slate-100 outline-none focus:border-orange-500">
                <input type="number" id="admin-price" placeholder="‡∫•‡∫≤‡∫Ñ‡∫≤ (‡∫Å‡∫µ‡∫ö)" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-slate-100 outline-none focus:border-orange-500">
                <select id="admin-category" class="w-full p-4 bg-slate-50 rounded-2xl font-bold border-2 border-slate-100 outline-none">
                    <option value="‡∫≠‡∫≤‡∫´‡∫≤‡∫ô">‡∫≠‡∫≤‡∫´‡∫≤‡∫ô</option>
                    <option value="‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°">‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°</option>
                </select>
                <input type="text" id="admin-img" placeholder="‡∫•‡∫¥‡ªâ‡∫á‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö (URL)" class="w-full p-4 bg-slate-50 rounded-2xl border-2 border-slate-100 outline-none text-[10px] italic">
                <button onclick="handleSaveMenu()" class="w-full bg-orange-600 text-white py-4 rounded-2xl font-black shadow-xl active-scale">‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡ªÄ‡∫°‡∫ô‡∫π</button>
                <button onclick="showPage('page-table')" class="w-full text-slate-400 font-bold py-2 active-scale text-sm">‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô</button>
            </div>
            <div id="admin-display-list" class="mt-8 space-y-2 overflow-y-auto max-h-48 pr-2"></div>
        </div>
    </div>

    <div id="page-report" class="hidden min-h-screen p-6 bg-slate-50">
        <div class="max-w-2xl mx-auto">
            <header class="flex justify-between items-center mb-10 text-slate-800">
                <h2 class="text-3xl font-black italic">‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç</h2>
                <button onclick="showPage('page-table')" class="bg-white px-6 py-3 rounded-2xl border-2 font-black active-scale shadow-sm">‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô</button>
            </header>
            <div class="grid grid-cols-2 gap-6 mb-10 text-center">
                 <div class="bg-slate-900 p-8 rounded-[3rem] text-white shadow-2xl">
                    <p class="text-[10px] text-orange-400 font-black uppercase mb-1">‡∫ç‡∫≠‡∫î‡∫°‡∫∑‡ªâ‡∫ô‡∫µ‡ªâ</p>
                    <h1 id="report-total-today" class="text-2xl font-black italic">0 KIP</h1>
                </div>
                <div class="bg-white p-8 rounded-[3rem] border shadow-sm text-center">
                    <p class="text-[10px] text-slate-400 font-black uppercase mb-1">‡∫ö‡∫¥‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</p>
                    <h1 id="report-count-all" class="text-2xl font-black italic">0</h1>
                </div>
            </div>
            <div id="report-daily-container" class="space-y-6 pb-32"></div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-[2rem] font-black text-sm hidden z-[100] shadow-2xl border-2 border-white/10 animate-fade-in"></div>

    <script>
        // Firebase Config (‡∫ï‡∫ª‡∫ß‡ªÄ‡∫Å‡∫ª‡ªà‡∫≤‡∫Ç‡∫≠‡∫á‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤)
        const firebaseConfig = {
            apiKey: "AIzaSyDrkORCwmsdCsdpH81Y40kaDpgrHU-U6ps",
            authDomain: "khaopiakpos.firebaseapp.com",
            databaseURL: "https://khaopiakpos-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "khaopiakpos",
            storageBucket: "khaopiakpos.firebasestorage.app",
            messagingSenderId: "51654913004",
            appId: "1:51654913004:web:57eb6bc244c1918beaaec9",
            measurementId: "G-FYB29D6N9D"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allMenus = [], cart = [], currentTable = "", activeOrders = {}, currentCategory = "‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î";

        function showPage(id) {
            document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'page-table') listenToOrders();
            if(id === 'page-report') loadReports();
        }

        function checkLogin() {
            if(document.getElementById('login-pass').value === 'jip1234') {
                showPage('page-table');
                document.getElementById('login-pass').value = "";
            } else { alert("‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ú‡ªà‡∫≤‡∫ô‡∫ö‡ªç‡ªà‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á!"); }
        }

        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerText = msg; x.classList.remove('hidden');
            setTimeout(() => { x.classList.add('hidden'); }, 2000);
        }

        async function handleSaveMenu() {
            const name = document.getElementById('admin-name').value;
            const price = document.getElementById('admin-price').value;
            const category = document.getElementById('admin-category').value;
            const img = document.getElementById('admin-img').value;
            if (name && price) {
                const ref = db.ref('menus').push();
                await ref.set({ id: ref.key, name, price: Number(price), category, img: img || '' });
                showToast("‚úÖ ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î");
                document.getElementById('admin-name').value = ""; document.getElementById('admin-price').value = ""; document.getElementById('admin-img').value = "";
            }
        }

        function loadMenus() {
            db.ref('menus').on('value', snap => {
                allMenus = snap.val() ? Object.values(snap.val()) : [];
                renderMenus(); renderAdminMenus();
            });
        }

        function renderMenus() {
            const filtered = allMenus.filter(m => currentCategory === "‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î" || m.category === currentCategory);
            const container = document.getElementById('menu-list');
            if (filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full py-20 text-center text-slate-300 font-bold italic">‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡ªÉ‡∫ô‡ªù‡∫ß‡∫î‡∫ô‡∫µ‡ªâ</div>`;
                return;
            }
            container.innerHTML = filtered.map(m => `
                <div onclick="addToCart('${m.name}', ${m.price})" class="bg-white rounded-[2rem] shadow-sm border border-slate-100 active-scale overflow-hidden text-center flex flex-col h-full hover:shadow-md transition-shadow">
                    <div class="w-full h-24 md:h-36 bg-slate-50 flex items-center justify-center overflow-hidden text-slate-300">
                        ${m.img ? `<img src="${m.img}" class="w-full h-full object-cover">` : `<i class="fas fa-image text-3xl"></i>`}
                    </div>
                    <div class="p-4">
                        <div class="font-black text-slate-800 text-[11px] md:text-xs truncate uppercase leading-tight">${m.name}</div>
                        <div class="text-orange-600 font-black text-xs mt-1">${m.price.toLocaleString()}</div>
                    </div>
                </div>`).join('');
        }

        function addToCart(name, price) {
            const item = cart.find(c => c.name === name);
            if(item) item.qty++; else cart.push({ name, price, qty: 1 });
            renderCart();
        }

        function updateQty(idx, delta) {
            cart[idx].qty += delta;
            if (cart[idx].qty <= 0) cart.splice(idx, 1);
            renderCart();
        }

        function renderCart() {
            let total = 0;
            document.getElementById('cart-items').innerHTML = cart.map((item, idx) => {
                const itemTotal = item.price * item.qty;
                total += itemTotal;
                return `
                <div class="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100">
                    <div class="flex-1 min-w-0 pr-3 text-left">
                        <p class="font-black text-slate-800 text-xs uppercase">${item.name}</p>
                        <p class="text-[10px] text-slate-400 font-bold mt-1">
                            ${item.price.toLocaleString()} x ${item.qty} = <span class="text-orange-600">${itemTotal.toLocaleString()}</span>
                        </p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="updateQty(${idx}, -1)" class="w-8 h-8 bg-white border rounded-xl text-slate-400 active-scale shadow-sm"><i class="fas fa-minus text-[10px]"></i></button>
                        <span class="font-black text-xs text-slate-700 w-4 text-center">${item.qty}</span>
                        <button onclick="updateQty(${idx}, 1)" class="w-8 h-8 bg-slate-900 rounded-xl text-white active-scale shadow-md"><i class="fas fa-plus text-[10px]"></i></button>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('total-price').innerText = total.toLocaleString();
            document.getElementById('cart-count').innerText = cart.length;
        }

        async function holdOrder() {
            if(cart.length === 0) return;
            await db.ref('activeOrders/' + currentTable).set({ items: cart, table: currentTable });
            showToast("üìå ‡∫û‡∫±‡∫Å‡∫ö‡∫¥‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î"); showPage('page-table');
        }

        async function clearTable() {
            if(confirm(`‡∫ó‡ªà‡∫≤‡∫ô‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫≠‡ªç‡ªÄ‡∫î‡∫µ‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡∫Ç‡∫≠‡∫á ${currentTable} ‡ªÅ‡∫•‡∫∞ ‡ªÉ‡∫´‡ªâ‡ªÄ‡∫õ‡∫±‡∫ô‡ªÇ‡∫ï‡∫∞‡∫ß‡ªà‡∫≤‡∫á‡ªÅ‡∫°‡ªà‡∫ô‡∫ö‡ªç?`)) {
                await db.ref('activeOrders/' + currentTable).remove();
                cart = []; renderCart(); showToast("üóëÔ∏è ‡∫•‡ªâ‡∫≤‡∫á‡ªÇ‡∫ï‡∫∞‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î"); showPage('page-table');
            }
        }

        async function checkout() {
            if(cart.length === 0) return;
            const total = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
            if(confirm(`‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫ä‡∫≥‡∫•‡∫∞: ${total.toLocaleString()} KIP?`)) {
                await db.ref('sales').push({ table: currentTable, total: total, items: cart.map(i => `${i.name} (x${i.qty})`).join(', '), date: new Date().toLocaleDateString(), timestamp: Date.now() });
                await db.ref('activeOrders/' + currentTable).remove();
                showToast("üí∞ ‡∫ä‡∫≥‡∫•‡∫∞‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î"); showPage('page-table');
            }
        }

        function listenToOrders() { db.ref('activeOrders').on('value', snap => { activeOrders = snap.val() || {}; renderTables(); }); }
        
        function renderTables() {
            const grid = document.getElementById('table-grid'); grid.innerHTML = '';
            for(let i=1; i<=12; i++) {
                const tableName = `‡ªÇ‡∫ï‡∫∞ ${i}`; const isActive = activeOrders[tableName];
                grid.innerHTML += `
                <div onclick="openPOS('${tableName}')" class="${isActive ? 'bg-orange-600 text-white scale-105 shadow-2xl shadow-orange-200' : 'bg-white text-slate-800'} p-10 rounded-[2.5rem] shadow-sm text-center font-black cursor-pointer transition-all border border-slate-100 active-scale relative group overflow-hidden">
                    ${isActive ? '<span class="absolute top-3 right-3 w-3 h-3 bg-white rounded-full animate-pulse"></span>' : ''}
                    <p class="text-2xl italic uppercase tracking-tighter">${tableName}</p>
                    <p class="text-[9px] uppercase mt-2 opacity-50 tracking-[0.2em] font-bold">${isActive ? '‡∫ö‡ªç‡ªà‡∫ß‡ªà‡∫≤‡∫á' : '‡∫ß‡ªà‡∫≤‡∫á'}</p>
                </div>`;
            }
        }

        function filterMenu(cat) {
            currentCategory = cat;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-orange-600', 'text-white', 'shadow-lg');
                btn.classList.add('bg-slate-100', 'text-slate-500');
                if(btn.innerText.includes(cat)) {
                    btn.classList.remove('bg-slate-100', 'text-slate-500');
                    btn.classList.add('bg-orange-600', 'text-white', 'shadow-lg');
                }
            });
            renderMenus();
        }

        function openPOS(tableName) { currentTable = tableName; document.getElementById('pos-table-name').innerText = tableName; cart = activeOrders[tableName] ? activeOrders[tableName].items : []; renderCart(); showPage('page-pos'); }
        function renderAdminMenus() { document.getElementById('admin-display-list').innerHTML = allMenus.map(m => `<div class="flex justify-between items-center bg-slate-50 p-3 rounded-2xl mb-1 text-[10px] font-black border border-slate-100"><span>${m.name}</span><button onclick="deleteMenu('${m.id}')" class="text-red-400 p-2"><i class="fas fa-trash-alt"></i></button></div>`).join(''); }
        async function deleteMenu(id) { if(confirm("‡∫•‡∫∂‡∫ö‡ªÄ‡∫°‡∫ô‡∫π‡∫ô‡∫µ‡ªâ?")) await db.ref('menus/' + id).remove(); }
        function loadReports() {
            db.ref('sales').on('value', snap => {
                const container = document.getElementById('report-daily-container');
                if(!snap.val()) { container.innerHTML = ""; return; }
                const sales = Object.entries(snap.val()).map(([id, val]) => ({ id, ...val })).sort((a, b) => b.timestamp - a.timestamp);
                const today = new Date().toLocaleDateString();
                let totalT = 0;
                const grouped = sales.reduce((acc, sale) => {
                    if(!acc[sale.date]) acc[sale.date] = { total: 0, items: [] };
                    acc[sale.date].total += sale.total; acc[sale.date].items.push(sale);
                    if(sale.date === today) totalT += sale.total;
                    return acc;
                }, {});
                document.getElementById('report-total-today').innerText = totalT.toLocaleString() + " KIP";
                document.getElementById('report-count-all').innerText = sales.length;
                container.innerHTML = Object.entries(grouped).map(([date, data]) => `
                    <div class="bg-white rounded-[2.5rem] shadow-sm border overflow-hidden">
                        <div class="bg-slate-900 p-5 flex justify-between items-center text-white text-[11px] font-black uppercase">
                            <span>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ ${date}</span>
                            <span class="text-orange-400 tracking-tighter text-lg">${data.total.toLocaleString()} KIP</span>
                        </div>
                        <div class="divide-y divide-slate-50">${data.items.map(s => `
                            <div class="p-5 flex justify-between items-center">
                                <div class="flex-1 pr-4 text-left">
                                    <span class="text-[9px] bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-black uppercase">${s.table}</span>
                                    <p class="text-slate-400 text-[10px] mt-2 font-bold">${s.items}</p>
                                </div>
                                <p class="font-black text-slate-800 text-sm">${s.total.toLocaleString()}</p>
                            </div>`).join('')}</div>
                    </div>`).join('');
            });
        }

        loadMenus(); listenToOrders();
    </script>
</body>
</html>