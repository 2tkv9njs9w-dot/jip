<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Khao Piak Jip Jip POS - Fixed Version</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans Lao', sans-serif; background-color: #f8fafc; user-select: none; }
        .hidden { display: none !important; }
        .active-scale:active { transform: scale(0.95); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="overflow-hidden">

    <section id="page-login" class="flex items-center justify-center min-h-screen bg-orange-600 p-6 z-[100] relative">
        <div class="bg-white p-12 rounded-[3.5rem] shadow-2xl w-full max-w-sm text-center border-b-8 border-orange-200">
            <h1 class="text-2xl font-black text-slate-800 mb-10 uppercase italic">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫õ‡∫Ω‡∫Å‡∫à‡∫¥‡∫ö‡ªÜ</h1>
            <div class="space-y-4">
                <input type="password" id="login-pass" placeholder="‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ú‡ªà‡∫≤‡∫ô" class="w-full px-6 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-center text-xl outline-none focus:border-orange-500 transition-all">
                <button onclick="checkLogin()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black shadow-xl active-scale">‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö</button>
            </div>
        </div>
    </section>

    <section id="page-table" class="hidden min-h-screen p-8 overflow-y-auto">
        <div class="max-w-7xl mx-auto">
            <header class="flex justify-between items-center mb-10">
                <h1 class="text-3xl font-black text-slate-900 italic uppercase">‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡ªÇ‡∫ï‡∫∞</h1>
                <div class="flex gap-3">
                    <button onclick="showPage('page-report')" class="w-12 h-12 bg-white rounded-xl shadow-sm border flex items-center justify-center text-emerald-600"><i class="fas fa-chart-line text-xl"></i></button>
                    <button onclick="showPage('page-admin')" class="w-12 h-12 bg-slate-900 rounded-xl shadow-lg flex items-center justify-center text-white"><i class="fas fa-plus text-xl"></i></button>
                </div>
            </header>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6" id="table-grid"></div>
        </div>
    </section>

    <section id="page-pos" class="hidden h-screen flex overflow-hidden">
        <main class="flex-1 flex flex-col bg-slate-50 overflow-hidden px-8 pt-6">
            <header class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-4">
                    <button onclick="backToTable()" class="w-10 h-10 bg-white rounded-xl border flex items-center justify-center text-slate-400 active-scale shadow-sm"><i class="fas fa-arrow-left"></i></button>
                    <h2 id="pos-table-name" class="text-2xl font-black text-slate-900 italic uppercase">‡ªÇ‡∫ï‡∫∞...</h2>
                </div>
                <nav class="flex gap-2 bg-white/50 p-1 rounded-xl border">
                    <button onclick="filterMenu('‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î')" class="cat-btn px-6 py-2 rounded-lg font-black text-[10px] uppercase bg-orange-600 text-white shadow-md">‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</button>
                    <button onclick="filterMenu('‡∫≠‡∫≤‡∫´‡∫≤‡∫ô')" class="cat-btn px-6 py-2 rounded-lg font-black text-[10px] uppercase text-slate-400">‡∫≠‡∫≤‡∫´‡∫≤‡∫ô</button>
                    <button onclick="filterMenu('‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°')" class="cat-btn px-6 py-2 rounded-lg font-black text-[10px] uppercase text-slate-400">‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°</button>
                </nav>
            </header>
            <div id="menu-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 no-scrollbar overflow-y-auto pb-32"></div>
        </main>

            <aside class="w-[400px] bg-white border-l flex flex-col shadow-2xl">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="font-black text-slate-800 italic">‡∫≠‡ªç‡ªÄ‡∫î‡∫µ‡ªâ‡ªÉ‡∫ô‡∫°‡∫∑</h3>
                <span id="cart-count-badge" class="bg-orange-100 text-orange-600 px-3 py-1 rounded-lg font-black text-[10px]">0 ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</span>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar"></div>
            <div class="p-8 border-t bg-slate-50 space-y-5">
                <div class="flex justify-between items-end">
                    <div>
                        <span class="text-slate-400 font-bold text-[10px] uppercase tracking-widest">‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</span>
                        <div class="flex items-baseline gap-1">
                            <span id="total-price" class="text-4xl font-black text-slate-900 tracking-tighter">0</span>
                            <span class="text-orange-600 font-black text-xs">KIP</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="saveCurrentOrder()" class="bg-slate-800 text-white py-4 rounded-2xl font-black active-scale text-xs uppercase">‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å</button>
                    <button onclick="checkout()" class="bg-orange-600 text-white py-4 rounded-2xl font-black active-scale text-lg uppercase">‡ªÑ‡∫•‡ªà‡ªÄ‡∫á‡∫¥‡∫ô</button>
                </div>
                <button onclick="clearTable()" class="w-full text-red-400 font-bold text-[9px] uppercase tracking-widest active-scale">‡∫•‡ªâ‡∫≤‡∫á‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</button>
            </div>
        </aside>
    </section>

    <section id="page-admin" class="hidden min-h-screen bg-slate-100 p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black text-slate-800 uppercase italic">‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÄ‡∫°‡∫ô‡∫π</h2>
                <button onclick="showPage('page-table')" class="bg-white px-6 py-2 rounded-xl font-bold border active-scale shadow-sm">‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô</button>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border space-y-4">
                    <input type="text" id="admin-name" placeholder="‡∫ä‡∫∑‡ªà‡ªÄ‡∫°‡∫ô‡∫π" class="w-full p-4 bg-slate-50 rounded-xl border outline-none">
                    <input type="text" id="admin-price" placeholder="‡∫•‡∫≤‡∫Ñ‡∫≤ (‡ªÄ‡∫ä‡∫±‡ªà‡∫ô: 40000,45000,50000)" class="w-full p-4 bg-slate-50 rounded-xl border outline-none">
                    <select id="admin-category" class="w-full p-4 bg-slate-50 rounded-xl border font-bold">
                        <option value="‡∫≠‡∫≤‡∫´‡∫≤‡∫ô">‡∫≠‡∫≤‡∫´‡∫≤‡∫ô</option>
                        <option value="‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°">‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫î‡∫∑‡ªà‡∫°</option>
                    </select>
                    <input type="text" id="admin-img" placeholder="URL ‡∫Æ‡∫π‡∫ö‡∫û‡∫≤‡∫ö (‡∫ñ‡ªâ‡∫≤‡∫°‡∫µ)" class="w-full p-4 bg-slate-50 rounded-xl border outline-none">
                    <button onclick="handleSaveMenu()" class="w-full bg-orange-600 text-white py-4 rounded-xl font-black shadow-lg">‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡ªÄ‡∫°‡∫ô‡∫π</button>
                </div>
                <div id="admin-display-list" class="bg-white rounded-[2rem] border overflow-y-auto max-h-[500px] p-4 space-y-2"></div>
            </div>
        </div>
    </section>

    <section id="page-report" class="hidden min-h-screen bg-slate-50 p-8 overflow-y-auto">
        <div class="max-w-5xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black text-slate-800 uppercase italic">‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç</h2>
                <button onclick="showPage('page-table')" class="bg-white px-6 py-2 rounded-xl font-bold border active-scale">‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô</button>
            </header>
            <div id="report-summary" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"></div>
            <div id="report-container" class="space-y-3"></div>
        </div>
    </section>

    <div id="toast" class="fixed top-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-3 rounded-full font-black text-[10px] hidden z-[200] shadow-2xl"></div>

    <script>
        // ‡∫ï‡∫±‡ªâ‡∫á‡∫Ñ‡ªà‡∫≤ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDrkORCwmsdCsdpH81Y40kaDpgrHU-U6ps",
            authDomain: "khaopiakpos.firebaseapp.com",
            databaseURL: "https://khaopiakpos-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "khaopiakpos",
            storageBucket: "khaopiakpos.firebasestorage.app",
            messagingSenderId: "51654913004",
            appId: "1:51654913004:web:57eb6bc244c1918beaaec9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allMenus = [], cart = [], currentTable = "", currentCategory = "‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î", isChanged = false;

        function showPage(id) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'page-table') listenTables();
            if(id === 'page-report') loadReports();
        }

        function checkLogin() {
            if(document.getElementById('login-pass').value === 'jip1234') showPage('page-table');
            else alert("‡∫•‡∫∞‡∫´‡∫±‡∫î‡∫ú‡ªà‡∫≤‡∫ô‡∫ú‡∫¥‡∫î!");
        }

        function showToast(msg) {
            const t = document.getElementById("toast");
            t.innerText = msg; t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 1500);
        }

        // --- ‡∫™‡ªà‡∫ß‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡ªÄ‡∫°‡∫ô‡∫π ‡ªÅ‡∫•‡∫∞ ‡∫Å‡∫≤‡∫ô‡∫™‡∫∞‡ªÅ‡∫î‡∫á‡∫ú‡∫ª‡∫ô ---
        function renderMenus() {
            const container = document.getElementById('menu-list');
            const filtered = allMenus.filter(m => currentCategory === "‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î" || m.category === currentCategory);
            
            container.innerHTML = filtered.map(m => {
                // ‡ªÅ‡∫ç‡∫Å‡∫•‡∫≤‡∫Ñ‡∫≤ ‡ªÅ‡∫•‡∫∞ ‡∫•‡ªâ‡∫≤‡∫á‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÉ‡∫´‡ªâ‡ªÄ‡∫õ‡∫±‡∫ô‡∫ï‡∫ª‡∫ß‡ªÄ‡∫•‡∫Å‡∫ö‡ªç‡∫•‡∫¥‡∫™‡∫∏‡∫î
                const priceArr = String(m.price).split(',').map(p => {
                    const clean = p.replace(/[^0-9]/g, '');
                    return clean ? parseInt(clean) : 0;
                });

                const isFood = m.category === '‡∫≠‡∫≤‡∫´‡∫≤‡∫ô';
                const p1 = priceArr[0] || 0;
                const p2 = priceArr[1] || p1;
                const p3 = priceArr[2] || p2;

                return `
                <div class="bg-white rounded-[2rem] border border-slate-100 shadow-sm overflow-hidden flex flex-col p-4">
                    <div class="w-full h-24 bg-slate-50 rounded-2xl mb-3 flex items-center justify-center overflow-hidden">
                        ${m.img ? `<img src="${m.img}" class="w-full h-full object-cover">` : `<i class="fas fa-utensils text-slate-200 text-3xl"></i>`}
                    </div>
                    <h4 class="font-black text-slate-800 text-[11px] mb-4 uppercase truncate">${m.name}</h4>
                    <div class="grid ${isFood ? 'grid-cols-3' : 'grid-cols-1'} gap-2">
                        ${isFood ? `
                            <button onclick="addToCart('${m.name}', ${p1}, '‡∫ô‡ªâ‡∫≠‡∫ç')" class="bg-orange-50 text-orange-600 text-[10px] font-black py-3 rounded-xl border border-orange-100 active-scale">‡∫ô‡ªâ‡∫≠‡∫ç</button>
                            <button onclick="addToCart('${m.name}', ${p2}, '‡∫Å‡∫≤‡∫á')" class="bg-orange-50 text-orange-600 text-[10px] font-black py-3 rounded-xl border border-orange-100 active-scale">‡∫Å‡∫≤‡∫á</button>
                            <button onclick="addToCart('${m.name}', ${p3}, '‡ªÉ‡∫´‡∫ç‡ªà')" class="bg-orange-50 text-orange-600 text-[10px] font-black py-3 rounded-xl border border-orange-100 active-scale">‡ªÉ‡∫´‡∫ç‡ªà</button>
                        ` : `
                            <button onclick="addToCart('${m.name}', ${p1}, '‡∫õ‡∫ª‡∫Å‡∫Å‡∫∞‡∫ï‡∫¥')" class="w-full bg-slate-900 text-white text-[10px] font-black py-3 rounded-xl active-scale shadow-md">
                                ${p1.toLocaleString()} KIP
                            </button>
                        `}
                    </div>
                </div>`;
            }).join('');
        }

        // --- ‡∫™‡ªà‡∫ß‡∫ô‡∫Å‡∫≤‡∫ô‡∫Ñ‡∫≥‡∫ô‡∫ß‡∫ô‡ªÉ‡∫ô‡∫Å‡∫∞‡∫ï‡ªà‡∫≤ (‡∫ö‡∫±‡∫á‡∫Ñ‡∫±‡∫ö‡ªÄ‡∫õ‡∫±‡∫ô Number 100%) ---
        function addToCart(name, price, size) {
            // ‡ªÅ‡∫õ‡∫á‡∫•‡∫≤‡∫Ñ‡∫≤‡ªÉ‡∫´‡ªâ‡ªÄ‡∫õ‡∫±‡∫ô Number ‡∫ó‡∫µ‡ªà‡ªÅ‡∫ô‡ªà‡∫ô‡∫≠‡∫ô
            const cleanPrice = Number(price);
            if (isNaN(cleanPrice)) return;

            const label = size === '‡∫õ‡∫ª‡∫Å‡∫Å‡∫∞‡∫ï‡∫¥' ? name : `${name} (${size})`;
            const itemKey = `${name}-${cleanPrice}-${size}`; 

            const foundIdx = cart.findIndex(i => `${i.baseName}-${i.price}-${i.size}` === itemKey);
            
            if (foundIdx > -1) {
                cart[foundIdx].qty = Number(cart[foundIdx].qty) + 1;
            } else {
                cart.push({
                    name: label,
                    baseName: name,
                    price: cleanPrice,
                    qty: 1,
                    size: size
                });
            }
            isChanged = true;
            updateCartUI();
            showToast(`+ ${label}`);
        }

        function updateQty(idx, delta) {
            const newQty = Number(cart[idx].qty) + delta;
            if (newQty <= 0) cart.splice(idx, 1);
            else cart[idx].qty = newQty;
            isChanged = true;
            updateCartUI();
        }

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            let total = 0;
            
            container.innerHTML = cart.map((item, idx) => {
                const subTotal = Number(item.price) * Number(item.qty);
                total += subTotal;
                return `
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex justify-between items-center">
                    <div class="flex-1 pr-2">
                        <p class="font-black text-slate-800 text-[11px]">${item.name}</p>
                        <p class="text-orange-600 font-bold text-[9px] mt-1">${item.price.toLocaleString()} KIP</p>
                    </div>
                    <div class="flex items-center gap-2 bg-white px-2 py-1 rounded-lg border">
                        <button onclick="updateQty(${idx}, -1)" class="w-7 h-7 flex items-center justify-center text-slate-300 active-scale"><i class="fas fa-minus text-[8px]"></i></button>
                        <span class="font-black text-[10px] w-5 text-center">${item.qty}</span>
                        <button onclick="updateQty(${idx}, 1)" class="w-7 h-7 flex items-center justify-center text-slate-900 active-scale"><i class="fas fa-plus text-[8px]"></i></button>
                    </div>
                </div>`;
            }).join('');

            document.getElementById('total-price').innerText = total.toLocaleString();
            document.getElementById('cart-count-badge').innerText = `${cart.length} ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô`;
        }

        // --- ‡∫•‡∫∞‡∫ö‡∫ª‡∫ö‡∫ñ‡∫≤‡∫ô‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô ---
        async function saveCurrentOrder() {
            if (!currentTable) return;
            await db.ref('activeOrders/' + currentTable).set({
                table: currentTable,
                items: cart,
                timestamp: Date.now()
            });
            isChanged = false;
            showToast("‚úÖ ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡ªÅ‡∫•‡ªâ‡∫ß");
        }

        async function backToTable() {
            if(isChanged && cart.length > 0) await saveCurrentOrder();
            showPage('page-table');
        }

        async function checkout() {
            if(cart.length === 0) return;
            let total = 0;
            cart.forEach(i => total += (Number(i.price) * Number(i.qty)));

            if(confirm(`‡ªÑ‡∫•‡ªà‡ªÄ‡∫á‡∫¥‡∫ô ${currentTable}: ${total.toLocaleString()} KIP?`)) {
                await db.ref('sales').push({
                    table: currentTable,
                    total: total,
                    items: cart.map(i => `${i.name} x${i.qty}`).join(', '),
                    date: new Date().toLocaleDateString(),
                    timestamp: Date.now()
                });
                await db.ref('activeOrders/' + currentTable).remove();
                cart = []; isChanged = false;
                showPage('page-table');
                showToast("üí∞ ‡∫ä‡∫≥‡∫•‡∫∞‡ªÄ‡∫á‡∫¥‡∫ô‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î");
            }
        }

        async function clearTable() {
            if(confirm("‡∫•‡∫∂‡∫ö‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î‡ªÉ‡∫ô‡ªÇ‡∫ï‡∫∞‡∫ô‡∫µ‡ªâ?")) {
                await db.ref('activeOrders/' + currentTable).remove();
                cart = []; isChanged = false;
                showPage('page-table');
            }
        }

        // --- Admin & Stats ---
        async function handleSaveMenu() {
            const name = document.getElementById('admin-name').value;
            const price = document.getElementById('admin-price').value;
            const category = document.getElementById('admin-category').value;
            const img = document.getElementById('admin-img').value;
            if(name && price) {
                const ref = db.ref('menus').push();
                await ref.set({ id: ref.key, name, price, category, img });
                document.getElementById('admin-name').value = '';
                document.getElementById('admin-price').value = '';
                showToast("‚úÖ ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡ªÅ‡∫•‡ªâ‡∫ß");
            }
        }

        function loadReports() {
            db.ref('sales').on('value', snap => {
                const data = snap.val();
                if(!data) return;
                const sales = Object.values(data).sort((a,b) => b.timestamp - a.timestamp);
                const today = new Date().toLocaleDateString();
                let todayTotal = 0, allTotal = 0;

                sales.forEach(s => {
                    const t = Number(s.total);
                    allTotal += t;
                    if(s.date === today) todayTotal += t;
                });

                document.getElementById('report-summary').innerHTML = `
                    <div class="bg-slate-900 p-6 rounded-3xl text-white shadow-xl">
                        <p class="text-[9px] font-black uppercase text-orange-400">‡∫ç‡∫≠‡∫î‡∫°‡∫∑‡ªâ‡∫ô‡∫µ‡ªâ</p>
                        <h2 class="text-2xl font-black italic">${todayTotal.toLocaleString()}</h2>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border shadow-sm text-center">
                        <p class="text-[9px] font-black uppercase text-slate-400">‡∫à‡∫≥‡∫ô‡∫ß‡∫ô‡∫ö‡∫¥‡∫ô</p>
                        <h2 class="text-2xl font-black italic text-slate-800">${sales.length}</h2>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border shadow-sm">
                        <p class="text-[9px] font-black uppercase text-slate-400">‡∫ç‡∫≠‡∫î‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î</p>
                        <h2 class="text-2xl font-black italic text-orange-600">${allTotal.toLocaleString()}</h2>
                    </div>`;

                document.getElementById('report-container').innerHTML = sales.map(s => `
                    <div class="bg-white p-4 rounded-2xl border flex justify-between items-center shadow-sm">
                        <div class="text-left">
                            <span class="bg-orange-50 text-orange-600 px-3 py-1 rounded-full text-[8px] font-black">${s.table}</span>
                            <p class="text-[9px] text-slate-500 mt-2 font-bold">${s.items}</p>
                            <p class="text-[7px] text-slate-300 mt-1">${new Date(s.timestamp).toLocaleString()}</p>
                        </div>
                        <p class="font-black text-slate-800">${Number(s.total).toLocaleString()}</p>
                    </div>`).join('');
            });
        }

        function filterMenu(c) {
            currentCategory = c;
            document.querySelectorAll('.cat-btn').forEach(b => {
                const isMatch = b.innerText.includes(c);
                b.className = isMatch ? 'cat-btn px-6 py-2 rounded-lg font-black text-[10px] uppercase bg-orange-600 text-white shadow-lg' : 'cat-btn px-6 py-2 rounded-lg font-black text-[10px] uppercase text-slate-400';
            });
            renderMenus();
        }

        function listenTables() {
            db.ref('activeOrders').on('value', snap => {
                const data = snap.val() || {};
                const grid = document.getElementById('table-grid');
                grid.innerHTML = '';
                for(let i=1; i<=12; i++) {
                    const name = `‡ªÇ‡∫ï‡∫∞ ${i}`;
                    const active = data[name];
                    grid.innerHTML += `
                    <div onclick="openPOS('${name}')" class="${active ? 'bg-orange-600 text-white shadow-2xl scale-105 border-transparent' : 'bg-white text-slate-800 border-slate-100'} p-8 rounded-[2rem] shadow-sm text-center font-black active-scale border transition-all cursor-pointer relative overflow-hidden">
                        <p class="text-xl italic tracking-tighter uppercase">${name}</p>
                        <p class="text-[8px] uppercase opacity-50 mt-1">${active ? '‡∫°‡∫µ‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤' : '‡ªÇ‡∫ï‡∫∞‡∫ß‡ªà‡∫≤‡∫á'}</p>
                    </div>`;
                }
            });
        }

        function openPOS(name) {
            currentTable = name;
            document.getElementById('pos-table-name').innerText = name;
            db.ref('activeOrders/' + name).once('value', snap => {
                const d = snap.val();
                cart = (d && d.items) ? d.items.map(i => ({...i, price: Number(i.price), qty: Number(i.qty)})) : [];
                isChanged = false;
                updateCartUI();
                showPage('page-pos');
            });
        }

        db.ref('menus').on('value', snap => {
            allMenus = snap.val() ? Object.values(snap.val()) : [];
            renderMenus();
            document.getElementById('admin-display-list').innerHTML = allMenus.map(m => `
                <div class="flex justify-between items-center bg-slate-50 p-4 rounded-xl border mb-2">
                    <span class="text-[10px] font-black">${m.name}</span>
                    <button onclick="db.ref('menus/${m.id}').remove()" class="text-red-400 p-2 hover:bg-red-50 rounded-lg"><i class="fas fa-trash-alt text-xs"></i></button>
                </div>`).join('');
        });

        listenTables();
    </script>
</body>
</html>